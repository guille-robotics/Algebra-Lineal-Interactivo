<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Gr√°fico - Transformaciones y Cambio de Base</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 25px;
            font-size: 2.2em;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 420px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .view-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .view-section h2 {
            text-align: center;
            margin-bottom: 12px;
            font-size: 1.2em;
            color: #333;
        }
        
        .world-view h2 {
            color: #667eea;
        }
        
        .camera-view h2 {
            color: #764ba2;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: crosshair;
        }
        
        .matrices-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .matrices-panel h3 {
            color: #333;
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .matrix-display {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .matrix-display h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .matrix-display.camera-matrix h4 {
            color: #764ba2;
        }
        
        .matrix {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            line-height: 1.6;
            color: #333;
            display: inline-block;
            border-left: 2px solid #333;
            border-right: 2px solid #333;
            padding: 8px 15px;
        }
        
        .properties {
            background: white;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .properties h4 {
            color: #764ba2;
            margin-bottom: 8px;
            text-align: center;
            font-size: 0.95em;
        }
        
        .property-item {
            padding: 5px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.85em;
            text-align: center;
        }
        
        .note-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8em;
            line-height: 1.4;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls h3 {
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .rotate-btn {
            background: #667eea;
            color: white;
        }
        
        .rotate-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        .reset-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .angle-display {
            text-align: center;
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .slider-container label {
            font-weight: 600;
            color: #555;
        }
        
        input[type="range"] {
            width: 300px;
            height: 6px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .formula-section {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .formula-section h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.2em;
            text-align: center;
        }
        
        .formula-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .formula {
            font-size: 1.4em;
            color: #333;
            margin: 10px 0;
        }
        
        .formula-explanation {
            color: #555;
            line-height: 1.6;
            font-size: 0.9em;
            text-align: left;
            margin-top: 10px;
        }
        
        .interpretation {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #764ba2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .interpretation h3 {
            color: #764ba2;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .interpretation p {
            color: #333;
            line-height: 1.7;
            font-size: 0.9em;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8em;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            border: 1px solid #333;
        }
        
        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Pipeline Gr√°fico: Transformaciones y Cambio de Base</h1>
        
        <!-- Controles en la parte superior -->
        <div class="controls">
            <h3>üéÆ Controles de Rotaci√≥n</h3>
            <div class="button-group">
                <button class="rotate-btn" onclick="rotateShip(90)">‚Ü∫ Girar 90¬∞</button>
                <button class="rotate-btn" onclick="rotateShip(45)">‚Ü∫ Girar 45¬∞</button>
                <button class="rotate-btn" onclick="rotateShip(30)">‚Ü∫ Girar 30¬∞</button>
                <button class="reset-btn" onclick="resetRotation()">‚ü≤ Reiniciar</button>
            </div>
            <div class="angle-display">√Ångulo actual: <span id="angleDisplay">0¬∞</span></div>
            <div class="slider-container">
                <label for="angleSlider">O ajusta manualmente:</label>
                <input type="range" id="angleSlider" min="0" max="360" value="0" oninput="setAngle(this.value)">
            </div>
        </div>
        
        <!-- Grid principal: 2 vistas + panel de matrices -->
        <div class="main-grid">
            <div class="view-section world-view">
                <h2>üåç Vista del Mundo (Base B)</h2>
                <canvas id="worldCanvas" width="380" height="380"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>Eje X</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #27ae60;"></div>
                        <span>Eje Y</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>Nave</span>
                    </div>
                </div>
            </div>
            
            <div class="view-section camera-view">
                <h2>üìπ Vista de C√°mara (Base B')</h2>
                <canvas id="cameraCanvas" width="380" height="380"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e67e22;"></div>
                        <span>Eje v‚ÇÅ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9b59b6;"></div>
                        <span>Eje v‚ÇÇ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>Nave</span>
                    </div>
                </div>
            </div>
            
            <!-- Panel de matrices al lado -->
            <div class="matrices-panel">
                <h3>üìä Matrices en Tiempo Real</h3>
                
                <div class="matrix-display">
                    <h4>Base Mundial [R]<sub>B</sub></h4>
                    <div class="matrix" id="matrixB"></div>
                </div>
                
                <div class="matrix-display camera-matrix">
                    <h4>Base C√°mara [R]<sub>B'</sub></h4>
                    <div class="matrix" id="matrixBprime"></div>
                </div>
                
                <div class="note-box">
                    <strong>üí° Nota:</strong> Las matrices son iguales en 90¬∞ porque la rotaci√≥n conmuta con la base de 45¬∞. Prueba otros √°ngulos (30¬∞, 45¬∞, 60¬∞) para ver matrices diferentes.
                </div>
                
                <div class="properties">
                    <h4>‚ú® Propiedades (Invariantes)</h4>
                    <div class="property-item"><strong>Det:</strong> <span id="det">1</span></div>
                    <div class="property-item"><strong>Traza:</strong> <span id="trace">0</span></div>
                    <div class="property-item"><strong>Tipo:</strong> Ortogonal</div>
                </div>
            </div>
        </div>
        
        <!-- F√≥rmula de cambio de base -->
        <div class="formula-section">
            <h3>üìê Ecuaci√≥n de Cambio de Base</h3>
            <div class="formula-box">
                <div class="formula">
                    [R]<sub>B'</sub> = P<sup>-1</sup> [R]<sub>B</sub> P
                </div>
                <div class="formula-explanation">
                    <strong>¬øC√≥mo funciona?</strong><br>
                    ‚Ä¢ <strong>P</strong> = matriz con vectores de la nueva base: P = [[1, -1], [1, 1]] (normalizado: P = 1/‚àö2 √ó eso)<br>
                    ‚Ä¢ <strong>P<sup>-1</sup></strong> convierte de c√°mara ‚Üí mundo, <strong>P</strong> convierte mundo ‚Üí c√°mara<br>
                    ‚Ä¢ Las matrices [R]<sub>B</sub> y [R]<sub>B'</sub> son <strong>semejantes</strong> (misma traza, determinante, eigenvalores)<br>
                    ‚Ä¢ En 90¬∞, resultan id√©nticas por simetr√≠a, pero en otros √°ngulos son diferentes num√©ricamente
                </div>
            </div>
        </div>
        
        <!-- Interpretaci√≥n -->
        <div class="interpretation">
            <h3>üí° Interpretaci√≥n Geom√©trica</h3>
            <p>
                Las matrices <strong>[R]<sub>B</sub></strong> y <strong>[R]<sub>B'</sub></strong> son <strong>semejantes</strong>, 
                representando la misma transformaci√≥n geom√©trica desde diferentes perspectivas. 
                Aunque pueden tener valores num√©ricos diferentes, mantienen las mismas propiedades algebraicas 
                (determinante, traza, valores propios). En el caso especial de 90¬∞, resultan id√©nticas porque 
                90¬∞ = 2 √ó 45¬∞, creando una relaci√≥n arm√≥nica con la base rotada 45¬∞ de la c√°mara.
            </p>
        </div>
    </div>

    <script>
        // Estado global
        let currentAngle = 0;
        
        // Canvas
        const worldCanvas = document.getElementById('worldCanvas');
        const cameraCanvas = document.getElementById('cameraCanvas');
        const worldCtx = worldCanvas.getContext('2d');
        const cameraCtx = cameraCanvas.getContext('2d');
        
        // Funci√≥n para dibujar grilla
        function drawGrid(ctx, width, height) {
            ctx.strokeStyle = '#e8e8e8';
            ctx.lineWidth = 0.5;
            
            const step = 40;
            for (let i = 0; i <= width; i += step) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, height);
                ctx.stroke();
            }
            for (let i = 0; i <= height; i += step) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(width, i);
                ctx.stroke();
            }
        }
        
        // Funci√≥n para dibujar ejes de coordenadas
        function drawAxes(ctx, centerX, centerY, basis = 'standard') {
            ctx.lineWidth = 2.5;
            
            if (basis === 'standard') {
                ctx.strokeStyle = '#e74c3c';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + 80, centerY);
                ctx.stroke();
                drawArrow(ctx, centerX, centerY, centerX + 80, centerY, '#e74c3c');
                
                ctx.strokeStyle = '#27ae60';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX, centerY - 80);
                ctx.stroke();
                drawArrow(ctx, centerX, centerY, centerX, centerY - 80, '#27ae60');
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('X', centerX + 90, centerY + 5);
                
                ctx.fillStyle = '#27ae60';
                ctx.fillText('Y', centerX + 5, centerY - 90);
            } else {
                ctx.strokeStyle = '#e67e22';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                const v1x = centerX + 60;
                const v1y = centerY - 60;
                ctx.lineTo(v1x, v1y);
                ctx.stroke();
                drawArrow(ctx, centerX, centerY, v1x, v1y, '#e67e22');
                
                ctx.strokeStyle = '#9b59b6';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                const v2x = centerX - 60;
                const v2y = centerY - 60;
                ctx.lineTo(v2x, v2y);
                ctx.stroke();
                drawArrow(ctx, centerX, centerY, v2x, v2y, '#9b59b6');
                
                ctx.fillStyle = '#e67e22';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('v‚ÇÅ', v1x + 5, v1y);
                
                ctx.fillStyle = '#9b59b6';
                ctx.fillText('v‚ÇÇ', v2x - 20, v2y);
            }
        }
        
        // Funci√≥n para dibujar flechas
        function drawArrow(ctx, fromX, fromY, toX, toY, color) {
            const headlen = 8;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
        }
        
        // Funci√≥n para dibujar la nave
        function drawShip(ctx, centerX, centerY, angle, scale = 1) {
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(-angle * Math.PI / 180);
            ctx.scale(scale, scale);
            
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.moveTo(0, -25);
            ctx.lineTo(-12, 18);
            ctx.lineTo(0, 8);
            ctx.lineTo(12, 18);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#2980b9';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.fillStyle = '#ecf0f1';
            ctx.beginPath();
            ctx.arc(0, -3, 4, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.restore();
        }
        
        // Funci√≥n para actualizar la visualizaci√≥n
        function updateVisualization() {
            worldCtx.clearRect(0, 0, worldCanvas.width, worldCanvas.height);
            cameraCtx.clearRect(0, 0, cameraCanvas.width, cameraCanvas.height);
            
            const centerX = 190;
            const centerY = 190;
            
            drawGrid(worldCtx, worldCanvas.width, worldCanvas.height);
            drawGrid(cameraCtx, cameraCanvas.width, cameraCanvas.height);
            
            drawAxes(worldCtx, centerX, centerY, 'standard');
            drawAxes(cameraCtx, centerX, centerY, 'isometric');
            
            drawShip(worldCtx, centerX, centerY, currentAngle, 1.3);
            drawShip(cameraCtx, centerX, centerY, currentAngle, 1.3);
            
            updateMatrices();
            
            document.getElementById('angleDisplay').textContent = currentAngle + '¬∞';
            document.getElementById('angleSlider').value = currentAngle;
        }
        
        // Funci√≥n para actualizar las matrices
        function updateMatrices() {
            const rad = currentAngle * Math.PI / 180;
            const cos = Math.cos(rad);
            const sin = Math.sin(rad);
            
            // Matriz en base est√°ndar
            const r11 = Math.abs(cos) < 0.0001 ? 0 : cos;
            const r12 = Math.abs(-sin) < 0.0001 ? 0 : -sin;
            const r21 = Math.abs(sin) < 0.0001 ? 0 : sin;
            const r22 = Math.abs(cos) < 0.0001 ? 0 : cos;
            
            document.getElementById('matrixB').innerHTML = 
                `${r11.toFixed(2)}&nbsp;&nbsp;${r12.toFixed(2)}<br>${r21.toFixed(2)}&nbsp;&nbsp;${r22.toFixed(2)}`;
            
            // Matriz en base isom√©trica (aplicando P^-1 * R * P)
            // P = 1/sqrt(2) * [[1, -1], [1, 1]]
            // P^-1 = 1/sqrt(2) * [[1, 1], [-1, 1]]
            const sqrt2 = Math.sqrt(2);
            
            // P^-1 * R
            const temp11 = (1/sqrt2) * (cos + sin);
            const temp12 = (1/sqrt2) * (-sin + cos);
            const temp21 = (1/sqrt2) * (-cos + sin);
            const temp22 = (1/sqrt2) * (-sin - cos);
            
            // (P^-1 * R) * P
            const rb11 = (1/sqrt2) * (temp11 - temp12);
            const rb12 = (1/sqrt2) * (temp11 + temp12);
            const rb21 = (1/sqrt2) * (temp21 - temp22);
            const rb22 = (1/sqrt2) * (temp21 + temp22);
            
            document.getElementById('matrixBprime').innerHTML = 
                `${rb11.toFixed(2)}&nbsp;&nbsp;${rb12.toFixed(2)}<br>${rb21.toFixed(2)}&nbsp;&nbsp;${rb22.toFixed(2)}`;
            
            // Propiedades invariantes
            const det = r11 * r22 - r12 * r21;
            const trace = r11 + r22;
            
            document.getElementById('det').textContent = det.toFixed(2);
            document.getElementById('trace').textContent = trace.toFixed(2);
        }
        
        // Funci√≥n para rotar la nave
        function rotateShip(degrees) {
            currentAngle = (currentAngle + degrees) % 360;
            if (currentAngle < 0) currentAngle += 360;
            updateVisualization();
        }
        
        // Funci√≥n para establecer √°ngulo
        function setAngle(angle) {
            currentAngle = parseInt(angle);
            updateVisualization();
        }
        
        // Funci√≥n para reiniciar
        function resetRotation() {
            currentAngle = 0;
            updateVisualization();
        }
        
        // Inicializar
        updateVisualization();
    </script>
</body>
</html>
